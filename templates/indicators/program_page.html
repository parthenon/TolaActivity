{% extends "base.html" %}
{% load i18n mathfilters mytags static %}
{% load render_bundle from webpack_loader %}
{% block title %}{% trans "Program indicators" %} | {% endblock %}
{% block page_title %}{{ program.name }}{% endblock %}
{% block header_extras %}
    <div class="program__calendar-complete">
        <div class="fas fa-calendar"></div>
        <p>
        {% blocktrans %}Program period is <br><strong>{{ percent_complete }}% complete</strong>{% endblocktrans %}
        </p>
    </div>
{% endblock %}

{% block content %}


    {% if indicator_count %}
        <aside class="program__status">
            <h2>{% trans "Program metrics" %}</h2>
            <div class="status__gauges">

            {% gauge_band program.scope_counts %}

            {% gauge_tank "targets_defined" "Indicators with targets" "have targets defined" "have no targets" "Add missing targets" "have missing targets" %}

            {% gauge_tank "reported_results" "Indicators with results" "have reported results" "have no results" "Add missing results" "have no results" %}

            {% gauge_tank "results_evidence"  "Results with evidence" "have evidence" "are missing evidence" "Add missing evidence"  "have results without evidence" %}
            </div>
        </aside>
    {% endif %}

    <div id="program-metrics-react-component"></div>

<div class="program-page__main">
    <div class="program-page__sidebar">
        <section class="sidebar__detail">
            <div class="form-group" id="id_div_indicators">
                <label for="id_indicators" class="col-form-label text-uppercase">
                    {% trans 'Indicators' %}
                </label>
                <div class="form-group-row">
                    <select name="indicators" id="id_indicators" class="form-control" multiple="multiple">
                        {% for ind in indicators %}
                            <option value="{{ ind.id }}">{{ ind.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group" id="id_div_levels">
                <label for="id_levels" class="col-form-label text-uppercase">
                    {% trans 'Levels' %}
                </label>
                <div class="form-group-row">
                    <select name="levels" id="id_levels" class="form-control" multiple="multiple">
                        {% for level in indicator_levels %}
                            <option value="{{ level.id }}">{{ level.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </section>
        <section class="sidebar__detail">
            <h3>{% trans "Program Details" %}</h3>
            <p><a href="{% url 'programIndicatorReport' program.id %}">{% trans "Indicator Plan" %}</a></p>
        </section>
        <section class="sidebar__detail">
            <h3>{% trans "Documents" %}</h3>
            <p><a href="{% url 'documentation_list' program.id 0 %}">{% trans "View program documents" %}</a></p>
            <a href="{% url 'documentation_add' %}?program_id={{ program.id }}" class="btn-add"><i class="fas fa-plus-circle"></i> {% trans "Add document" %}</a>
        </section>
        <section class="sidebar__detail">
            <h3>{% trans "Sites" %}</h3>
            <p><a href="{% url 'siteprofile_list' program.id 0 %}">{% trans "View Program Sites" %}</a></p>
            <a href="{% url 'siteprofile_add' %}" class="btn-add"><i class="fas fa-plus-circle"></i> {% trans "Add site" %}</a>
        </section>
        <section class="sidebar__detail">
            <h3>{% trans "Pinned Reports" %}</h3>
            <ul class="pinned-reports">
                {% for pr in pinned_reports %}
                    <li class="pinned-report">
                        <a href="{% url 'iptt_report' pr.program_id pr.report_type %}?{{ pr.query_string }}" class="pinned-report__link">
                            <h4>{% trans "IPTT:" %} {{ pr.name }}</h4>
                           {{ pr.date_range_str }}
                        </a>
                        {% if pr.id %}
                        <a href="#"
                           class="pinned-report__remove text-danger"
                           data-delete-pinned-report="{{ pr.id }}">
                            <i class="fa fa-times"></i>
                        </a>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
            <a href="{% url 'iptt_quickstart' %}?program_id={{ program.id }}" class="btn-add"><i class="fas fa-plus-circle"></i> {% trans "Create an IPTT report" %}</a>
        </section>
    </div>

    <div id="indicator-list-react-component" class="indicators-list program-page__indicators"></div>

</div>

{% include "indicators/indicator_list_modals.html" %}
{% include 'indicators/indicator_form_common_js.html' %}
{% include 'indicators/collecteddata_form_common_js.html' %}
{% endblock content %}


{% block extra_js_in_body %}
    <script>
        let jsContext = {{ js_context|js }};
    </script>

{#    <script src="{% static "js/program_page_filters.js" %}"></script>#}

    {% render_bundle 'program_page' %}
{% endblock %}
